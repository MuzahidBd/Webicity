import org.gradle.internal.os.OperatingSystem

plugins {
	id 'com.github.johnrengelman.shadow' version '6.1.0'
    id 'application'
    id 'java'
}

switch (OperatingSystem.current()) {
	case OperatingSystem.LINUX:
		def osArch = System.getProperty("os.arch")
		project.ext.lwjglNatives = osArch.startsWith("arm") || osArch.startsWith("aarch64")
			? "arm64"
			: "natives-linux"
		project.ext.skijaNatives = "skija-linux"
		break
	case OperatingSystem.WINDOWS:
		project.ext.lwjglNatives = "natives-windows"
		project.ext.skijaNatives = "skija-windows"
		break
}

repositories {
    mavenCentral()
    maven {
    	url 'https://jitpack.io'
    	url "https://packages.jetbrains.team/maven/p/skija/maven"
	}
}

dependencies {
	implementation 'com.google.code.gson:gson:2.8.7'
	//implementation 'net.java.dev.jna:jna:5.5.0'
	implementation 'com.github.marianobarrios:tls-channel:0.4.2'
	implementation 'org.brotli:dec:0.1.2'
	
	implementation 'com.github.taucher2003:t2003-logger-impl:1.0.1'
	implementation 'com.github.taucher2003:t2003-logger-binder:1.0.1'
	
	implementation platform("org.lwjgl:lwjgl-bom:3.2.3")

	implementation "org.lwjgl:lwjgl"
	implementation "org.lwjgl:lwjgl-glfw"
	implementation "org.lwjgl:lwjgl-openal"
	implementation "org.lwjgl:lwjgl-opengl"
	implementation "org.lwjgl:lwjgl-stb"
	runtimeOnly "org.lwjgl:lwjgl::$lwjglNatives"
	runtimeOnly "org.lwjgl:lwjgl-glfw::$lwjglNatives"
	runtimeOnly "org.lwjgl:lwjgl-openal::$lwjglNatives"
	runtimeOnly "org.lwjgl:lwjgl-opengl::$lwjglNatives"
	runtimeOnly "org.lwjgl:lwjgl-stb::$lwjglNatives"
	
	implementation "org.jetbrains.skija:${skijaNatives}:0.93.0"
	
	testImplementation "org.junit.jupiter:junit-jupiter-engine:5.8.1"
}

apply plugin: 'java'
apply plugin: 'application'
apply plugin: 'eclipse'

sourceSets {
	main {
		java {
			srcDirs = [
				'src/main/java/everyos.browser.spec',
				'src/main/java/everyos.browser.webicity',
				'src/main/java/everyos.browser.webicitybrowser',
				'src/main/java/everyos.engine.ribbon.core',
				'src/main/java/everyos.engine.ribbon.renderer.skijarenderer',
				'src/main/java/everyos.engine.ribbon.ui.simple',
				'src/main/java/everyos.api.getopts'
			]
		}
	}
}

test {
	useJUnitPlatform()
}

mainClassName = "everyos.browser.webicitybrowser.Webicity"

jar {
	manifest {
		attributes(
			"Main-Class": mainClassName
		)
	}
}